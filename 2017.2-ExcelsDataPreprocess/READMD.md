## 数据分析记录1：对一次大量excel表格数据处理的记录
### 背景
在一家制造业公司实习，管理人员让我分析一下他们以前的生产情况日报表文件，包括每一次生产的原料用量、设备运行耗费原料和时间、成本费用、产出等。一共两年的数据。
### 原始数据结构
- 源数据是54个Excel文件，每个文件有20多个sheet，也就相当于54 x 20个表，这些报表有日报表、周报表或月度报表。
- 每一个报表格式比较固定，基本是左边项目名称，右边是数值这类。但是合并的单元格以及小计总计较多，并且也有前后格式微调（从某时间起报表增加了1列）的现象。表与表之间还有数据链接，这些数据处理起来难度适中。

### 处理思路和流程
1. 为了获取最细节的信息，我选择只用日报表进行处理，利用python的excel处理模块，按位置进行数据提取，其中需要对项目名称单元格进行检测，检测为对应的指标标签后写入新的数据到list中。最终将54 x 20 的报表，每个报表100个数据，变为1080 x 100的矩阵，这个矩阵可以写入numpy缓存文件中。（当时采用的方法是写入csv文件）
2. 关于python中的excel处理模块，非常混杂，xlrd是专用于读取表格，xlwt用于写入。原报表是xls格式，xls格式的列**最多只能支持256列**，所以需要转为xlsx格式处理，而xlwt不能写入xlsx格式，同时，xlrd还不能够读取报表中的计算公式结果，于是选择openpyxl模块比较合适（当时先用的xlrd和xlwt，初步整理过后才使用的openpyxl）。
3. 首先建立一个字典，key为指标名称，value为指标值所在的excel上的位置，（字典有100多项）。然后对于每个文件（已经使用类似按键精灵的脚本将全部存储为xlsx文件，并存储数值而非公式）获取sheet的名称（名称就是日期），将其写入行，也就说第一行是日期，而第一列是指标名称。然后按照位置一一对应写入数据。对于出现多了一行导致错位的数据，采用检测某个单元格位置进行判断是否需要修正错位来进行。
4. 在实际的操作中，是分批进行的（遇到的问题是模块只能够写入xls文件，所以一次只能255列，因此要分批次（现在想起来，不应该直接将提取到的数据立即写入另一个excel文件中，应该用numpy缓存的方式），完成之后得到了5个xls文件。
5. 随后就手动将这5个xls文件合并，并写入一个csv文件。（直接用文本的方式写入csv文件，对于python来讲效率极低，推荐使用numpy.to_csv）。
6. 然后将这个csv文件转置，写入一个xlsx文件，同时将日期格式化为数值型。
7. 处理完之后进行了可视化，首先用直方图进行数值分布的统计，然后选取了一个最主要的y指标a（比如产品质量），用每一个指标在每个时间段的变化率δb（比如某原料的添加量）除以δa，得到在a变动下b的变化率，这个值的大小或许能够反映出受哪种影响因素高


### 心得
当时处理起来一开始思路很清晰，但之后越写代码就越混乱。如今过了几个月回来看，觉知以前的代码惨不忍睹，这里也收获了很多经验教训：
1. 用代码实现自己预想好的逻辑时，如果越来越混乱，那么多半是自己没有规划好，应当在一开始就整理好处理的逻辑。
2. 预想好进行处理的逻辑后，**构思好为了实现逻辑所需要的包，或者先把这些逻辑分解写成函数，即使参数多也没关系，重要的是逻辑要“打包”，打包支线，留下主线**
3. **将逻辑分解成小块，然后构思或者实现好每一个小块的逻辑后，再将这些块串成主线连接，连接完就可以进行处理了。我之前在这个数据分析中犯的最大错误，就是拿到数据之后立马开始写代码，没有思考整个过程，于是写代码的过程中不断有很多新的逻辑混乱成一团。虽然最后完成了任务，但是这样写出来的代码可读性很差**

### 附件：
上传了原来处理的数据的格式，内容已删除。
